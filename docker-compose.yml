services:
    postgres:
        image: postgres
        restart: always
        ports:
            - 5432:5432
        environment:
            - POSTGRES_USER=${DB_USER}
            - POSTGRES_PASSWORD=${DB_PASS}
            - POSTGRES_DB=${DB_NAME}
            - DRIZZLE_SSL=${DRIZZLE_SSL:false}
            - API_PORT=${API_PORT:8080}
            - NODE_ENV=${NODE_ENV:dev}
        healthcheck:
            test: [ "CMD-SHELL", "pg_isready -U postgres" ]
            interval: 2s
            timeout: 2s
            retries: 5
        networks:
            - back-tier

networks:
    front-tier:
        attachable: true
    back-tier: {}
